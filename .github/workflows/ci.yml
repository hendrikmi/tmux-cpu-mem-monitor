name: 'Run test suite'

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review
  pull_request_target:

jobs:
  # test:
  #   runs-on: ${{ matrix.os }}
  #   strategy:
  #     matrix:
  #       python-version: ['3.9', '3.10', '3.11']
  #       os: [ubuntu-latest, windows-latest, macos-latest]

  #   steps:
  #     - uses: actions/checkout@v4

  #     - name: Set up Python ${{ matrix.python-version }}
  #       uses: actions/setup-python@v5
  #       with:
  #         python-version: ${{ matrix.python-version }}

  #     - name: Install dependencies
  #       run: |
  #         python -m pip install --upgrade pip
  #         pip install -r requirements-dev.txt

  #     - name: Run tests
  #       run: |
  #         pytest -v

  format:
    runs-on: ubuntu-latest
    permissions:
      checks: write
    outputs:
      file: ${{ steps.ruff.outputs.file }}
      message: ${{ steps.ruff.outputs.message }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2

          # Checkout the fork/head-repository and push changes to the fork.
          # If you skip this, the base repository will be checked out and changes
          # will be committed to the base repository!
          repository: ${{ github.event.pull_request.head.repo.full_name }}

          # Checkout the branch made in the fork. Will automatically push changes
          # back to this branch.
          ref: ${{ github.head_ref }}

      - name: Install Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ruff

      # Update output format to enable automatic inline annotations.
      - name: Run Ruff
        id: ruff
        run: |
          ruff format

      - uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Format code with Ruff"
          commit_options: "--no-verify --amend --no-edit"
          skip_fetch: true
